<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>THDX ‚Ä¢ Sepolia ‚Üí Monad Bridge</title>
<meta name="theme-color" content="#0b1220" />
<style>
  :root{
    --bg:#0b1220;--card:#121a2a;--muted:#9aa6b2;--stroke:#22304a;--text:#e6edf3;
    --pri1:#6ee7ff;--pri2:#7c5cff;--ok:#22c55e;
  }
  *{box-sizing:border-box}body{
    margin:0;min-height:100svh;display:grid;place-items:center;background:var(--bg);
    color:var(--text);font-family:Inter,system-ui,Arial,sans-serif
  }
  .wrap{width:min(560px,92vw)}
  .card{background:var(--card);border:1px solid var(--stroke);border-radius:14px;padding:22px;box-shadow:0 6px 20px rgba(0,0,0,.35)}
  h1{margin:0 0 6px;font-size:22px}
  p.sub{margin:0 0 16px;color:var(--muted)}
  label{display:block;margin:12px 0 6px;color:#cfe3ff;font-weight:600;font-size:13px}
  select,input{width:100%;padding:12px 13px;border-radius:10px;border:1px solid var(--stroke);background:#0f1625;color:#fff;font-size:14px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  button{
    width:100%;padding:12px;border:0;border-radius:10px;color:#fff;font-weight:700;cursor:pointer;
    background:linear-gradient(90deg,var(--pri1),var(--pri2));transition:.2s;margin-top:12px
  }
  button.secondary{background:#1b263b}
  button.ok{background:linear-gradient(90deg,#16a34a,#22c55e)}
  button:disabled{opacity:.55;cursor:not-allowed}
  pre{
    margin-top:14px;white-space:pre-wrap;background:#0f1625;border:1px solid var(--stroke);
    border-radius:10px;padding:12px;min-height:120px;font-size:12.5px
  }
  .hint{color:var(--muted);font-size:12px;margin-top:6px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>THDX ‚Ä¢ Wormhole Bridge</h1>
      <p class="sub">Mode: <b>Sepolia ‚Üí Monad (testnet)</b></p>

      <div class="row">
        <button id="btnConnect">üîå Connect Wallet</button>
        <button id="btnApprove" class="secondary" disabled>‚úÖ Approve</button>
      </div>

      <label>Token</label>
      <select id="tokenSel">
        <option value="USDC">USDC (6 desimal)</option>
        <option value="USDT">USDT (6 desimal)</option>
        <option value="WBTC">WBTC (8 desimal)</option>
      </select>

      <label>Jumlah (angka manusia, contoh: 10)</label>
      <input id="amount" type="number" placeholder="Contoh: 10" inputmode="decimal"/>

      <label>Recipient (EVM) ‚Ä¢ default: alamat sendiri</label>
      <input id="recipient" type="text" placeholder="0x..." />

      <button id="btnBridge" class="ok" disabled>üöÄ Bridge ke Monad</button>
      <div class="hint">
        Wormhole TokenBridge (Sepolia): <code>0x6c5aAE4622B835058A41879bA5e128019B9047d6</code><br/>
        DstChain (Monad testnet) Wormhole ChainID: <code>31041</code>
      </div>

      <pre id="log">log siap...</pre>
    </div>
  </div>

<!-- === Ethers loader otomatis === -->
<script>
(function loadEthers(){
  const add = (src, cb)=>{
    const s=document.createElement('script');
    s.src=src; s.onload=cb;
    s.onerror=()=>console.error('Gagal load',src);
    document.body.appendChild(s);
  };
  if(typeof window.ethers==="undefined"){
    add("https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js", initTHDXBridge);
  } else initTHDXBridge();
})();

function initTHDXBridge(){
(() => {
  const CHAIN_SEPOLIA = 11155111;
  const WORMHOLE_BRIDGE = "0x6c5aAE4622B835058A41879bA5e128019B9047d6";
  const DST_CHAIN_ID = 31041;
  const TOKENS = {
    USDC: { addr: "0x1c7D4B196Cb0C7B01d743Fbc6116a902379C7238", decimals: 6 },
    USDT: { addr: "0xaA8E23Fb1079EA71e0a56F48a2aA51851D8433D0", decimals: 6 },
    WBTC: { addr: "0x52eeA312378ef46140EBE67dE8a143BA2304FD7C", decimals: 8 },
  };

  let provider, signer, me;
  const $ = (q)=>document.querySelector(q);
  const log = (m)=>{const el=$("#log");el.textContent+=(el.textContent?"\n":"")+m;el.scrollTop=el.scrollHeight;console.log(m);};
  const toBytes32Address = (addr)=>"0x"+"0".repeat(64-40)+addr.toLowerCase().replace(/^0x/,"");
  const parseAmount = (v,d)=>ethers.utils.parseUnits(String(v),d);
  const ensureSepolia = async()=>{
    const net=await provider.getNetwork();
    if(net.chainId===CHAIN_SEPOLIA)return;
    log(`‚ö†Ô∏è Bukan di Sepolia (chainId: ${net.chainId}). Switching...`);
    await provider.send("wallet_switchEthereumChain",[{chainId:"0xaa36a7"}]);
  };

  $("#btnConnect").onclick = async()=>{
    try{
      if(!window.ethereum) throw new Error("Buka di MetaMask/OKX/Trust browser.");
      provider=new ethers.providers.Web3Provider(window.ethereum,"any");
      await provider.send("eth_requestAccounts",[]);
      signer=provider.getSigner(); me=await signer.getAddress();
      await ensureSepolia();
      $("#recipient").value=me;
      $("#btnApprove").disabled=false; $("#btnBridge").disabled=false;
      log(`‚úÖ Connected: ${me}\nChain: ${(await provider.getNetwork()).chainId}`);
    }catch(e){log("‚ùå Connect error: "+(e.message||e));}
  };

  $("#btnApprove").onclick=async()=>{
    try{
      const sel=$("#tokenSel").value; const {addr,decimals}=TOKENS[sel];
      const amount=parseAmount($("#amount").value.trim(),decimals);
      const erc20=new ethers.Contract(addr,["function approve(address,uint256)"],signer);
      log(`üßæ Approve ${sel}...`);
      const tx=await erc20.approve(WORMHOLE_BRIDGE,amount);
      log(`‚è≥ Approve TX: ${tx.hash}`); await tx.wait();
      log(`‚úÖ Approve ${sel} sukses!`);
    }catch(e){log("‚ùå Approve error: "+(e.reason||e.message||e));}
  };

  $("#btnBridge").onclick=async()=>{
    try{
      const sel=$("#tokenSel").value; const {addr,decimals}=TOKENS[sel];
      const amount=parseAmount($("#amount").value.trim(),decimals);
      const recipient=($("#recipient").value||me).trim();
      const bridge=new ethers.Contract(WORMHOLE_BRIDGE,[
        "function transferTokens(address,uint256,uint16,bytes32,uint256,uint32) payable"
      ],signer);
      const nonce=Math.floor(Math.random()*2**32);
      log(`üöÄ Mengirim ${$("#amount").value} ${sel} ke Monad...`);
      const tx=await bridge.transferTokens(addr,amount,DST_CHAIN_ID,toBytes32Address(recipient),0,nonce);
      log(`üì¶ TX: ${tx.hash}`); const rc=await tx.wait();
      if(rc.status!==1) throw new Error("Transaksi gagal, cek Etherscan.");
      log("‚úÖ Bridge sukses! Tunggu VAA & mint di Monad.");
    }catch(e){log("‚ùå Bridge error: "+(e.reason||e.message||e));}
  };
})();
}
</script>
</body>
</html>
